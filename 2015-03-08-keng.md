# 坑

在这里记录一些容易踩的坑或者是个人认为容易误解或忽略的东西, 按时间倒序

1. node 判断 `file.type` (MIME type) 时, 如果要判断是 zip, 需要同时判断 `application/zip` 和 `application/x-zip-compressed`(暂时不清楚什么情况下会出现第二个), 甚至这些[库](https://github.com/broofa/node-mime)都不能判断

1. [bash 设置代理时各个应用取的字段不同, 没有统一的标准](https://unix.stackexchange.com/questions/212894/whats-the-right-format-for-the-http-proxy-environment-variable-caps-or-no-ca)
    
* 比如 [axios](https://github.com/axios/axios/pull/366)
    
1. [箭头函数并不暴露 arguments 对象](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions#No_binding_of_arguments)

1. `Proxy SwitchyOmega` 等某些代理在进行转发时, 会把 url 添加上 host, 这样 node 端接收到的 URL(req.url) 就是添加了 host 的了
    
* [Http 请求头中的 Proxy-Connection by ququ](https://imququ.com/post/the-proxy-connection-header-in-http-request.html)
    
1. `console.log(JSON.parse(JSON.stringify(obj)))`: chrome dev tools 里正确拿到 object 对象的 console 方法(否则看到的可能是修改后的对象

1. [chrome 里 `Array.prototype.sort()` 当个数大于 10 的时候如果排序函数不完整会出现错误](https://stackoverflow.com/questions/23076776/sorting-an-array-of-more-than-10-objects-in-chrome)
    * 这个不能算是 chrome(v8) 的 bug, 因为标准里规定是要把 sort 函数写完整的...( elements that compare equal do not necessarily remain in their original order)
    * [chrome 70(v8.7.0) 的排序算法更 stable 了](https://twitter.com/mathias/status/1036626116654637057)

    ```javascript
    function itemSorter() {
      return -1;
    }
    ["a", "b","c", "d", "e", "f", "g", "h", "i", "j", "k"].sort(itemSorter)
    // ["a", "c", "d", "e", "b", "g", "h", "i", "j", "k", "f"]
    ```

1. checkbox 和 radio 标签在 chrome 里默认宽高为 auto, 在 safari 里为 16px, 且自带 border 和 background;

1. [getcomputedstyle并不能正确获取 placeholder 样式](https://bugs.chromium.org/p/chromium/issues/detail?id=666204)

1. [button 等特殊元素在设为 block 后默认仍然不会填满父元素宽度(Replaced elements)](https://stackoverflow.com/questions/27605390/why-doesnt-display-block-width-auto-stretch-a-button-to-fill-the-contai/27605483)

1. [`target.currentTarget`在冒泡完成后会变成 null, 因此如果在 setTimeout 后(已经进入了下一个 tick?!)再去拿将会拿不到](https://stackoverflow.com/questions/39649156/event-currenttarget-ch]r-settimeout)

1. 浏览器会将相同的请求，依次发出（前一个请求响应后，再发出下一个请求)

1. [`XMLHttpRequest.DONE` 在 ios 的 UIWebview 时有小概率值为 undefined, 而在同款手机的 safari 里则没有这个问题](https://stackoverflow.com/questions/6898559/problem-with-xmlhttprequest-done-values)

1. [`await` 在使用 `forEach` 的时候是不起作用的, 还是要用普通的 for](https://stackoverflow.com/questions/37576685/using-async-await-with-a-foreach-loop/37576787#37576787)

1. `Object.keys` 在 转换的时候会优先把 array like 的 key 按顺序往前排

    ```javascript
    Object.keys({b: 'd', '1.0.0': 'd', 2: '2', 1: 'b', 3: '3'}) === ["1", "2", "3", "b", "1.0.0"]
    ```

1. [decodeURI 在 Chrome 里打印的时候会自动缩短显示， 导致直接复制再粘贴到地址栏的时候出错](https://stackoverflow.com/questions/19184313/disable-url-shortening-formatting-in-chromes-console). 解决方法: `copy()` or  `console.dir()`

1. 国内因为 GFW 原因造成chrome手机调试失败原因 :`https://chrome-devtools-frontend.appspot.com/` 这个链接被墙了

1. [使用px2rem时,webpack压缩时候会把css的注释先去除，然后在loader](https://github.com/songsiqi/px2rem/issues/2)

1. 不要忽略 [zero width space](https://www.google.com/search?{google:acceptedSuggestion}oq=%25E2%2580%258B&sourceid=chrome&ie=UTF-8&q=%25E2%2580%258B) 的存在...

1. 在使用了 `overflow:hidden` 后, 各家浏览器默认的 `vertical-align` 默认的 `baseline` 表现方式不同. 最好改为 `top` , `bottom` 或 `middle`.

1. `filter`会把子元素也变透明, [background `rgba不会`](https://css-tricks.com/rgba-browser-support/)

1. [`beforeunload`在iOS里不支持](https://stackoverflow.com/questions/3239834/window-onbeforeunload-not-working-on-the-ipad), 可以考虑使用 pagehide 代替

1. 常识: `redux` 和 `react`结合时, `dispatch`完`action`后, 虽然全局的state树改变了, 但是当前`component`的`props`值是不会马上改变的(setState是异步的)

1. [设置完cookie然后马上杀进程cookie还来不及存到硬盘里](https://code.google.com/p/chromium/issues/detail?id=496564)

1. [`border-radius`在Android下的几个BUG](http://www.css88.com/archives/5550)

1. [`position: fix`在chrome里,如果父元素有transform属性, `fix`属性失效](https://code.google.com/p/chromium/issues/detail?id=20574): [example](http://jsfiddle.net/rastrano/2PNFy/)

1. [handlebars](https://handlebarsjs.com/) 在前端使用的时候会自动编译出`sourceMappingURL`, 导致 Webpack 里console.log 追踪不到源文件

1. [关于inline-block中的white-space(50%问题)](https://css-tricks.com/fighting-the-space-between-inline-block-elements/)

1. [`for...of`在使用`babel`时不要忘了加载polyfill, 因为 babel 的实现需要 Symbol 支持,Most desktop browsers support Symbol natively but not mobile browsers](https://github.com/babel/babel/issues/1825)

1. [`new Date("2011-02-07")` 类似的格式在 IE或者Safari会报错,要改成`new Date("02/07/2011")`](http://biostall.com/javascript-new-date-returning-nan-in-ie-or-invalid-date-in-safari)

1. [fix ajax.js withCredentials bug in android for zepto](https://github.com/madrobby/zepto/pull/935)

1. PA: ajax在传含有中文的对象的时候如果不设置UTF-8可能会有签名错误: `contentType: "application/x-www-form-urlencoded;charset=UTF-8"`

1. `textarea`的 `maxLength` 在某些机型计算换行符为2个字符(大部分), 某些为1个字符(Android4.4)
