# å­—ç¬¦ç¼–ç (Character Encoding)

2019-07-26

## åŸºç¡€

### æœ¯è¯­

* å­—ç¬¦é›†(character set): ä¸€ä¸ªç³»ç»Ÿæ”¯æŒçš„æ‰€æœ‰æŠ½è±¡å­—ç¬¦çš„é›†åˆ
* å­—ç¬¦æ˜ å°„(character map)
* å­—ç¬¦ç¼–ç (character encoding): ä¸€å¥—æ³•åˆ™, ä½¿ç”¨è¯¥æ³•åˆ™èƒ½å¤Ÿå¯¹å­—ç¬¦çš„ä¸€ä¸ªé›†åˆè¿›è¡Œé…å¯¹
* ä»£ç é¡µ(code page)

è¿™äº›è™½ç„¶æœ‰äº›ä¸åŒ, ä½†æ˜¯åœ¨åŽ†å²ä¸Šå¾€å¾€è¡¨è¿°æ—¶åˆæ˜¯åŒä¹‰æ¦‚å¿µ

### è¿›åˆ¶

* 2(Binary)
* 8(Oct)
* 10(Decimal)
* 16(Hex)
  * 0x prefix in javascript
  * æ¯”å¦‚: 0x00: 00000000, 0x7F: 01111111

### å®¹é‡å•ä½

* 1bit(ä½, å°b) ä¸º 0/1 çš„å•ä½
* 1Byte(å­—èŠ‚, å¤§B) = 8bit
* 1K = 1024
* 1M = 1024K
* 1G = 1024M
* 1T = 1024G
* 1P = 1024T

## ASCII

American Standard Code for Information Interchange, ç¾Žå›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç 

8bit(æ‰€ä»¥ä¸€ä¸ªå­—èŠ‚æ˜¯8 bit), æœ€å¤šå¯æœ‰ 256 ä¸ªå­—ç¬¦

ç¬¬ä¸€ä½ä¸º 0 çš„(0-127)å±žäºŽåŸºæœ¬å­—ç¬¦è¡¨, æ¯”å¦‚ `A` æ˜¯ 65(0x41) `a` åˆ™æ˜¯ 97(0x61), æœ€æ—©çš„è‹±è¯­çŽ¯å¢ƒä¸‹ä½¿ç”¨è¿™ä¸ªå°±å¯ä»¥äº†

![1968 ascii](https://upload.wikimedia.org/wikipedia/commons/c/cf/USASCII_code_chart.png)
> [ASCII Table](https://www.rapidtables.com/code/text/ascii-table.html)

## ä¸‡ç å¥”è…¾çš„å¹´ä»£

### Extended ASCII

ç¬¬ä¸€ä½ä¸º 1 çš„(128-255)å±žäºŽæ‰©å±•å­—ç¬¦è¡¨(Extended ASCII), æ‰©å……å‡ºæ¥çš„ç¬¦å·åŒ…æ‹¬è¡¨æ ¼ç¬¦å·ã€è®¡ç®—ç¬¦å·ã€å¸Œè…Šå­—æ¯å’Œç‰¹æ®Šçš„æ‹‰ä¸ç¬¦å·, ä»–çš„å–å€¼åœ¨ä¸åŒçš„ç¼–ç ç³»ç»Ÿä¸­éƒ½æœ‰æ‰€ä¸åŒ

ä¸€äº›ä¸»è¦çš„ Extended ASCII çš„ ç¼–ç ç³»ç»Ÿæœ‰:

* Dos
  * Code page 437: å§‹ç¥–IBM PCï¼ˆä¸ªäººè®¡ç®—æœºï¼‰æˆ–MS-DOSä½¿ç”¨çš„å­—ç¬¦ç¼–ç 
* [ISO/IEC 8859](https://zh.wikipedia.org/wiki/ISO/IEC_8859)
  * ISO 8859-1 (Latin-1) - è¥¿æ¬§è¯­è¨€
  * ISO 8859-2 (Latin-2) - ä¸­æ¬§è¯­è¨€
  * ISO 8859-3 (Latin-3) - å—æ¬§è¯­è¨€
  * ISO 8859-4 (Latin-4) - åŒ—æ¬§è¯­è¨€
  * ISO 8859-5 (Cyrillic) - æ–¯æ‹‰å¤«è¯­è¨€
  * etc...
  * ISO 8859-16 (Latin-10) - ä¸œå—æ¬§è¯­è¨€ã€‚ä¸»è¦ä¾›ç½—é©¬å°¼äºšè¯­ä½¿ç”¨ï¼Œå¹¶åŠ å…¥æ¬§å…ƒç¬¦å·ã€‚
* [Windows code page](https://en.wikipedia.org/wiki/Windows_code_page) åˆè¢«ç§°ä½œ ANSI code page
  * Windows-1250 (Latin-2) - ä¸­æ¬§è¯­è¨€
  * Windows-1251 (Cyrillic) - æ–¯æ‹‰å¤«è¯­è¨€
  * Windows-1252 (Latin-1) - è¥¿æ¬§è¯­è¨€
  * etc...
  * Windows-1258 - è¶Šå—è¯­
* å…¶ä»–


### äºšæ´²æ–‡å­—

* [GB2312(GB0)](https://zh.wikipedia.org/wiki/GB_2312)
  * ä¸¤ä¸ªå¤§äºŽ127çš„å­—ç¬¦è¿žåœ¨ä¸€èµ·æ—¶ï¼Œå°±è¡¨ç¤ºä¸€ä¸ªæ±‰å­—ï¼Œå‰é¢çš„ä¸€ä¸ªå­—èŠ‚(é«˜å­—èŠ‚)ä»Ž 0xA1 ç”¨åˆ° 0xF7ï¼ŒåŽé¢ä¸€ä¸ªå­—èŠ‚(ä½Žå­—èŠ‚)ä»Ž0xA1åˆ°0xFE
    * ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªæ±‰å­—éœ€è¦ç”¨ 16 bit æ¥è¡¨ç¤º
    * è¿™äº›å­—èŠ‚æ€»å…±å¯ä»¥è¡¨ç¤º 87 * 94 = 8178 ä¸ªå­—ç¬¦, åŒ…æ‹¬äº†å¤§å¤šæ•°æ±‰å­å’Œå…¨è§’å­—ç¬¦
    * å…±æ”¶å½•äº† 6763 ä¸ªæ±‰å­—
  * æ—©æœŸçš„åŒºä½ç è¾“å…¥å°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è¾“å…¥æ±‰å­—çš„
  * ä¸èƒ½å¤„ç†æ€»ç†çš„åå­—...é™¶å–†ä¹Ÿå¾ˆå°´å°¬...
  * GBK(k: æ‰©å±•)
    * Windows å®šä¹‰å‡ºæ¥çš„ä¸œè¥¿, ä¸æ˜¯æ ‡å‡†ä½†æ˜¯æˆä¸ºäº†äº‹å®žæ ‡å‡†
    * Windows ç³»ç»Ÿé‡Œä»ç„¶æœ‰å¤š APP å»¶ç»­äº† GBK æ ‡å‡†
    * æŸ¥çœ‹ [windows code page](https://en.wikipedia.org/wiki/Windows_code_page): `chcp`
      * ä¸€èˆ¬éƒ½æ˜¯ 936 -> GBK
  * GB18030: åŸºäºŽ GBK æŽ¥ç»­æ‰©å±•äº†ä¸€äº›æ°‘æ—è¯­è¨€ç­‰å­—ç¬¦
* BIG5
  * ç”¨äºŽç¹ä½“ä¸­æ–‡
  * è¿˜è®°å¾—å°æ—¶å€™æ¸¸æˆæœ‰ä¹±ç çš„æ—¶å€™, è¦ç”¨å—æžæ˜Ÿè½¬ BIG5

![å—æžæ˜Ÿ](https://www.njstar.com/gif/njcom3/viewer_codes_menu_cn.gif)

å¡žç­æ—¶ä»£, éžä¸­æ–‡ä¸–ç•Œçš„æ‰‹æœºé‡Œè¿˜æœ‰é»˜è®¤ä¸­æ–‡å­—ç¬¦æ— æ³•æ˜¾ç¤ºçš„[é—®é¢˜](http://bbs.xineurope.com/thread-1112196-1-1.html)

## Unicode

å°†è¿™ä¸ªä¸–ç•Œä¸Šæ‰€æœ‰çš„ç¬¦å·çº³å…¥å…¶ä¸­, æ¯ä¸€ä¸ªç¬¦å·éƒ½ç»™äºˆä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–ç , ç†è®ºä¸Šå¯ä»¥å®¹çº³ 100 å¤šä¸‡ä¸ªç¬¦å·, ä»ç„¶åœ¨ä¸æ–­å¢žåŠ ä¸­(è€ƒå¤, æ–°è¯, emoji)

ä¾‹å¦‚ `U+0041` è¡¨ç¤ºä¸º `A` `U+535A` è¡¨ç¤ºä¸º `åš`

Mac è‡ªå¸¦çš„ç¨‹åºçŒ¿è®¡ç®—å™¨ä¸Šå°±å¯ä»¥æ–¹ä¾¿çš„æŸ¥è¯¢ Unicode

* [Unicode å­—ç¬¦å¹³é¢æ˜ å°„](https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84)
  * å‘Šè¯‰äº†æˆ‘ä»¬æŸä¸€ç±»çš„å­—ç¬¦åœ¨ Unicode é‡Œçš„ä½ç½®
  * ä¸»è¦ä½¿ç”¨çš„æ˜¯ BMP(åªæœ‰æœ€ä½Ž4ä½æœ‰å€¼:U+XXXX): [åŸºæœ¬å¤šæ–‡ç§å¹³é¢](https://zh.wikipedia.org/wiki/Unicode%E5%AD%97%E7%AC%A6%E5%B9%B3%E9%9D%A2%E6%98%A0%E5%B0%84#%E5%9F%BA%E6%9C%AC%E5%A4%9A%E6%96%87%E7%A7%8D%E5%B9%B3%E9%9D%A2)
    * æ±‰å­—ä¸»è¦åˆ†å¸ƒåœ¨[ä¸­æ—¥éŸ©ç»Ÿä¸€è¡¨æ„æ–‡å­—(CJK Unified Ideographs)](https://zh.wikipedia.org/wiki/%E4%B8%AD%E6%97%A5%E9%9F%93%E7%B5%B1%E4%B8%80%E8%A1%A8%E6%84%8F%E6%96%87%E5%AD%97)
      * ä»¤å’Œ(U+32FF)åŠ å…¥ Unicode, å´ä¸åœ¨[ä¸­æ—¥éŸ©å…¼å®¹å­—ç¬¦]((https://zh.wikipedia.org/wiki/%E4%B8%AD%E6%97%A5%E9%9F%93%E7%9B%B8%E5%AE%B9%E5%AD%97%E5%85%83))é‡Œ... ä½ç½®ä¸å¤Ÿäº†..

### å­˜å‚¨ Unicode çš„æ–¹æ³•

* [UTF-8](https://zh.wikipedia.org/wiki/UTF-8)
  * å˜é•¿ç¼–ç æ–¹å¼(1-4å­—èŠ‚)
  * å¦‚æžœä¸ºäº†å­˜å‚¨æ±‰å­—è€Œä¸€è‚¡è„‘çš„æŠŠè‹±æ–‡å­—ç¬¦çš„å­˜å‚¨ä¹Ÿå®šä¸º 16bit æ˜¯ä¸€ç§æžå¤§çš„æµªè´¹, ç”šè‡³æœ‰ä¸€äº›æ›´å¤§çš„ç¬¦å·éœ€è¦æ›´å¤šçš„ bit è¡¨ç¤º
  * å¯¹äºŽå•å­—èŠ‚(8bit)çš„ç¬¦å·: å­—èŠ‚çš„ç¬¬ä¸€ä½è®¾ä¸º0, åŽé¢7ä½ä¸ºè¿™ä¸ªç¬¦å·çš„ Unicode ç . å› æ­¤å¯¹äºŽè‹±è¯­å­—æ¯, UTF-8 ç¼–ç å’Œ ASCII ç æ˜¯ç›¸åŒçš„
  * å¯¹äºŽ n å­—èŠ‚çš„ç¬¦å·ï¼ˆn > 1ï¼‰: ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å‰ n ä½éƒ½è®¾ä¸º1, ç¬¬n + 1ä½è®¾ä¸º0, åŽé¢å­—èŠ‚çš„å‰ä¸¤ä½ä¸€å¾‹è®¾ä¸º10. å‰©ä¸‹çš„æ²¡æœ‰æåŠçš„äºŒè¿›åˆ¶ä½, å…¨éƒ¨ä¸ºè¿™ä¸ªç¬¦å·çš„ Unicode ç .
  * ä¹Ÿå°±æ˜¯è¯´, å¦‚æžœä¸€ä¸ªå­—èŠ‚çš„ç¬¬ä¸€ä½æ˜¯0, åˆ™è¿™ä¸ªå­—èŠ‚å•ç‹¬å°±æ˜¯ä¸€ä¸ªå­—ç¬¦. å¦‚æžœç¬¬ä¸€ä½æ˜¯1, åˆ™è¿žç»­æœ‰å¤šå°‘ä¸ª1, å°±è¡¨ç¤ºå½“å‰å­—ç¬¦å ç”¨å¤šå°‘ä¸ªå­—èŠ‚
    * 000000 - 00007F: 0xxxxxxx
    * 000080 - 0007FF: 110xxxxx 10xxxxxx
    * 000800 - 00FFFF: 1110xxxx 10xxxxxx 10xxxxxx
    * 010000 - 10FFFF: 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
    * etc...
  * æ‰€ä»¥å¼€å§‹çš„128ä¸ªå­—ç¬¦ï¼ˆASCIIï¼‰åªéœ€1å­—èŠ‚, æŽ¥ä¸‹æ¥çš„ä¸€äº›è¥¿æ–¹çš„å­—ç¬¦å’Œç¬¦å·éœ€è¦ä¸¤ä¸ªå­—ç¬¦. ä¸­æ–‡ç­‰äºšæ´²æ–‡å­—éœ€è¦3ä¸ªå­—èŠ‚, å‰©ä½™å­—ç¬¦éœ€è¦å››ä¸ªå­—èŠ‚
    * `A` => `U+0041` => `01000001`
    * `åš`: `U+535A` => `11100101 10001101 10011010`
* å…¶ä»–
  * UTF-16(UCS-2 + [Surrogate pair](http://unicode.org/glossary/#surrogate_pair), è¿™æ ·å°±å¯ä»¥è¡¨ç¤ºæ¯” 65536 æ›´å¤šä¸ªå­—ç¬¦äº†)
    * ç”¨2ä¸ªæˆ–4ä¸ªå­—èŠ‚è¡¨ç¤º
    * éœ€è¦è¡¨æ˜Žå­—èŠ‚åº
  * UTF-32(UCS-4)
    * ç”¨4ä¸ªå­—èŠ‚è¡¨ç¤º
    * éœ€è¦è¡¨æ˜Žå­—èŠ‚åº
* BOM: byte order mark
  * å‡ºçŽ°åœ¨æ–‡ä»¶å¼€å¤´
  * å­—èŠ‚åº
    * Big Endian æ˜¯æŒ‡ä½Žåœ°å€ç«¯å­˜æ”¾é«˜ä½å­—èŠ‚; Little Endian æ˜¯æŒ‡ä½Žåœ°å€ç«¯å­˜æ”¾ä½Žä½å­—èŠ‚.
    > è¿™ä¸¤ä¸ªå¤æ€ªçš„åç§°æ¥è‡ªè‹±å›½ä½œå®¶æ–¯å¨å¤«ç‰¹çš„ã€Šæ ¼åˆ—ä½›æ¸¸è®°ã€‹ã€‚åœ¨è¯¥ä¹¦ä¸­ï¼Œå°äººå›½é‡Œçˆ†å‘äº†å†…æˆ˜ï¼Œæˆ˜äº‰èµ·å› æ˜¯äººä»¬äº‰è®ºï¼Œåƒé¸¡è›‹æ—¶ç©¶ç«Ÿæ˜¯ä»Žå¤§å¤´(Big-endian)æ•²å¼€è¿˜æ˜¯ä»Žå°å¤´(Little-endian)æ•²å¼€ã€‚ä¸ºäº†è¿™ä»¶äº‹æƒ…ï¼Œå‰åŽçˆ†å‘äº†å…­æ¬¡æˆ˜äº‰ï¼Œä¸€ä¸ªçš‡å¸é€äº†å‘½ï¼Œå¦ä¸€ä¸ªçš‡å¸ä¸¢äº†çŽ‹ä½
    * ä»¥æ±‰å­—åšä¸ºä¾‹, Unicode ç æ˜¯535A, éœ€è¦ç”¨ä¸¤ä¸ªå­—èŠ‚å­˜å‚¨. å­˜å‚¨çš„æ—¶å€™ï¼Œ53åœ¨å‰ï¼Œ5Aåœ¨åŽæ˜¯ Big endian æ–¹å¼; 5Aåœ¨å‰, 53åœ¨åŽæ˜¯ Little endian æ–¹å¼
    * å¦‚æžœä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å¤´ä¸¤ä¸ªå­—èŠ‚æ˜¯FE FFï¼Œå°±è¡¨ç¤ºè¯¥æ–‡ä»¶é‡‡ç”¨å¤§å¤´æ–¹å¼; å¦‚æžœå¤´ä¸¤ä¸ªå­—èŠ‚æ˜¯FF FE, å°±è¡¨ç¤ºè¯¥æ–‡ä»¶é‡‡ç”¨å°å¤´æ–¹å¼
  * UTF-8: EF BB BF
  * UTF-16 little-endian: FF FE
  * UTF-16 big-endian: FE FF
  * UTF-32 little-endian: FF FE 00 00
  * UTF-32 big-endian: 00 00 FE FF

### emoji ç»„åˆå­—ç¬¦

* é€šè¿‡é›¶å®½åº¦è¿žæŽ¥ç¬¦`U+200D`å®žçŽ°
* æ¯”å¦‚`U+1F468 U+200D U+1F469 U+200D U+1F467` å°±ä¼šæ˜¾ç¤ºä¸ºä¸€ä¸ª Emoji ðŸ‘¨â€ðŸ‘©â€ðŸ‘§
  `[..."ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦"]`

## æ‰‹æŒä¸¤æŠŠé”Ÿæ–¤æ‹· å£ä¸­ç–¾å‘¼çƒ«çƒ«çƒ« è„šè¸åƒæœµå±¯å±¯å±¯ ç¬‘çœ‹ä¸‡ç‰©é”˜é”˜é”˜

* é”Ÿæ–¤æ‹·
  * GBK è½¬åˆ° Unicode æ—¶, ä¼šå°†æ²¡æ³•å±•ç¤ºçš„ Unicode ç¬¦å·, æ›¿æ¢ä¸º U+FFFD `ï¿½` (replacement character), UTF-8 ç¼–ç ä¸º: `1110,1111 1011,1111 1011,1101` -> 0xEFBFBD
  * å¦‚æžœæœ‰è¿žç»­ä¸¤ä¸ªæ— æ³•å±•ç¤ºçš„ç¬¦å·, åˆ™å­˜å‚¨ä¸º 0xEF 0xBF 0xBD 0xEF 0xBF 0xBD
  * GBK-> é”Ÿï¼ˆ0xEFBFï¼‰æ–¤ï¼ˆ0xBDEFï¼‰æ‹·ï¼ˆ0xBFBDï¼‰
* VC ä¸­æ–‡ç‰ˆä¸­çš„ `çƒ«çƒ«çƒ«` å’Œ `å±¯å±¯å±¯`
* é”˜é”˜é”˜: UTF-8 BOM å¤´ (0xEFBB)

## Javascript è½¬æ¢ API

* UTF-16
  * String.prototype.charCodeAt(): returns an integer between 0 and 65535 representing the UTF-16 code unit at the given index(å¹¶ä¸é€‚ç”¨äºŽå¢žè¡¥å­—ç¬¦)
  * String.fromCharCode()
* Unicode code point
  * String.prototype.codePointAt()
  * String.fromCodePoint()
* encodeURIComponent æ˜¯åŸºäºŽ UTF-8 çš„

> [ä½ è¿˜åœ¨ç”¨charCodeAté‚£ä½ å°±outäº† by akira-cn](https://github.com/akira-cn/FE_You_dont_know/issues/4)

## Base64

Base64æ˜¯ä¸€ç§åŸºäºŽ64ä¸ªå¯æ‰“å°å­—ç¬¦(A-Z, a-z, 0-9, +, /)æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚æ¯6ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒ, å¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦

è‹¥åŽŸæ•°æ®é•¿åº¦ä¸æ˜¯3çš„å€æ•°æ—¶ä¸”å‰©ä¸‹1ä¸ªè¾“å…¥æ•°æ®ï¼Œåˆ™åœ¨ç¼–ç ç»“æžœåŽåŠ 2ä¸ª=ï¼›è‹¥å‰©ä¸‹2ä¸ªè¾“å…¥æ•°æ®ï¼Œåˆ™åœ¨ç¼–ç ç»“æžœåŽåŠ 1ä¸ª=

> [wikipedia: base64](https://zh.wikipedia.org/wiki/Base64)

* ç”¨äºŽURLçš„æ”¹è¿›Base64ç¼–ç : å®ƒä¸åœ¨æœ«å°¾å¡«å…… `=`, å¹¶å°†æ ‡å‡†Base64ä¸­çš„ `+` å’Œ `/` åˆ†åˆ«æ”¹æˆäº† `-` å’Œ `_`

> [å­—ç¬¦ç¼–ç é‚£ç‚¹äº‹ï¼šå¿«é€Ÿç†è§£ASCIIã€Unicodeã€GBKå’ŒUTF-8(è¿™é‡Œå¯¹ GB ç¼–ç çš„è¡¨è¿°æ„Ÿè§‰æœ‰å¤±å…¬å…)](https://zhuanlan.zhihu.com/p/38333902?group_id=993169701098414080z)
>
> [Kerning Panic Â· å­—è°ˆå­—ä¸²ï¼ˆäºŒï¼‰](https://kernelpanic.fm/42)
>
> [Unicode å­—ç¬¦ç™¾ç§‘](https://unicode-table.com/cn/)
